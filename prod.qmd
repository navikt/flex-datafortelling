---
title: "Hello world"
format:
    html:
        self-contained: true
---

> Team-flex datafortelling

```{python}
from datetime import datetime

print(datetime.now())

import matplotlib.pyplot as plt

# Data for plotting
x = [1, 2, 3, 4, 5]
y = [1, 2, 3, 4, 5]

# Create the plot
plt.plot(x, y)

# Add title and labels
plt.title('Hello World Graph')
plt.xlabel('x-axis')
plt.ylabel('y-axis')

# Show the plot
plt.show()

import os
from google.cloud import bigquery
credentials_path = os.path.expanduser('~/.config/gcloud/application_default_credentials.json')

authenticated_locally = os.path.isfile(credentials_path)
running_in_dev = os.getenv('ENVIRONMENT', '').lower() == 'dev'
running_in_prod = os.getenv('ENVIRONMENT', '').lower() == 'prod'



if authenticated_locally or running_in_prod:  # Check if the file exists
    if authenticated_locally:
        os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = credentials_path

    bigquery_client = bigquery.Client(project='flex-prod-af40')

    query = """
 

    WITH data_in_last_7_days AS (
      SELECT svar
      FROM `flex-prod-af40.flex_dataset.flexjar_feedback_view`
      WHERE opprettet >= TIMESTAMP(DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY))
      and feedbackId = 'ditt-sykefravaer-fant-du'
    ),

    no_counts AS (
      SELECT COUNT(*) AS total,
      COUNTIF(svar = 'NEI') AS nei_count,
        COUNTIF(svar = 'FORBEDRING') AS forbedring_count
      FROM data_in_last_7_days
    )



    SELECT ROUND(((nei_count + forbedring_count)  / total * 100), 1) AS percentage
    FROM no_counts
    """

    query_job = bigquery_client.query(query)
    result = query_job.result()

    # Hvis sp√∏rringen din returnerer en rad, kan du hente denne raden
    for row in result:
        nei_forbedring_siste_7 = row.percentage

    print(f'Prosent siste 7: {nei_forbedring_siste_7}')

else:

    print("Credentials file not found OR not running in prod. Functionality requiring credentials/prod env will be skipped.")

```